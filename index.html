<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Acceso Universidad</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="header-container">
      <div class="header-left">
        <img src="logo-universidad.png" alt="UPQROO" class="logo">
        <div class="divider"></div>
        <h1 class="system-title">Sistema de Control de Acceso</h1>
      </div>
      <div class="admin-section" id="adminSection">
        <!-- El admin info se insertará aquí dinámicamente -->
      </div>
    </div>
  </header>

  <!-- Sistema de tabs -->
  <div class="tabs-container">
    <div class="tabs">
      <button class="tab-button active" onclick="switchTab('scanner')">
        <span class="tab-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg>
        </span>
        Escáner QR
      </button>
      <button class="tab-button" onclick="switchTab('generator')">
        <span class="tab-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
          </svg>
        </span>
        Generar QR
      </button>
      <button class="tab-button" onclick="switchTab('editar')">
        <span class="tab-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
          </svg>
        </span>
        Editar
      </button>
      <button class="tab-button" onclick="switchTab('registros')">
        <span class="tab-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 3h18v18H3z"/>
            <path d="M3 9h18M3 15h18M9 3v18"/>
          </svg>
        </span>
        Registros
      </button>
    </div>
  </div>

  <main>
    <!-- Tab del Scanner -->
    <div id="scanner-tab" class="tab-content active">
      <div class="scanner-container">
        <h2>Escanear Código QR</h2>
        <p class="instructions">Por favor, coloque su código QR frente a la cámara</p>
        <div id="reader"></div>
        <div id="result">Esperando escanear código QR...</div>
        <div class="scanner-controls">
          <button id="continueButton" class="control-button" style="display: none;">
            Continuar Escaneando
          </button>
        </div>
      </div>
    </div>

    <!-- Tab del Generador QR -->
    <div id="generator-tab" class="tab-content">
      <div class="qr-generator-container">
        <div class="section-header">
          <h2>Generador de Código QR</h2>
          <p>Cree códigos QR para estudiantes y personal</p>
        </div>

        <!-- Switch de modo -->
        <div class="mode-switch-container">
          <span class="switch-label" id="label-registro">Registrar y Generar</span>
          <label class="ios-switch">
            <input type="checkbox" id="modeSwitch" onchange="toggleMode()">
            <span class="slider"></span>
          </label>
          <span class="switch-label inactive" id="label-qr">Solo Generar</span>
        </div>

        <form id="qr-form">
          <div class="form-group">
            <label for="matricula">Matrícula *</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                  <path d="M6 12v5c0 2 4 3 6 3s6-1 6-3v-5"/>
                </svg>
              </span>
              <input 
                type="text" 
                id="matricula" 
                class="form-control" 
                placeholder="Ej: 202300097"
                pattern="[0-9]{9}"
                maxlength="9"
                required
              >
            </div>
            <div class="input-helper">Ingrese la matrícula de 9 dígitos</div>
          </div>

          <div class="form-group">
            <label for="nombres">Nombres *</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </span>
              <input 
                type="text" 
                id="nombres" 
                class="form-control" 
                placeholder="Nombres"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="apellidos">Apellidos *</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </span>
              <input 
                type="text" 
                id="apellidos" 
                class="form-control" 
                placeholder="Apellidos"
                required
              >
            </div>
          </div>

          <div class="form-group">
            <label for="curp">CURP *</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                  <rect x="8" y="2" width="8" height="4" rx="1"/>
                </svg>
              </span>
              <input 
                type="text" 
                id="curp" 
                class="form-control" 
                placeholder="Ej: ABCD123456HDFRNN09"
                pattern="[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9]{2}"
                maxlength="18"
                required
              >
            </div>
            <div class="input-helper">18 caracteres en mayúsculas</div>
          </div>

          <div class="form-group">
            <label for="tipo_persona">Tipo de Persona *</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                  <circle cx="7" cy="7" r="1.5" fill="currentColor"/>
                </svg>
              </span>
              <select id="tipo_persona" class="form-control" required>
                <option value="">Seleccione...</option>
                <option value="estudiante">Estudiante</option>
                <option value="docente">Docente</option>
                <option value="administrativo">Administrativo</option>
                <option value="otro">Otro</option>
              </select>
            </div>
          </div>

          <div class="form-group" id="carrera-group" style="display: none;">
            <label for="id_carrera">Carrera *</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
              </span>
              <select id="id_carrera" class="form-control">
                <option value="">Seleccione...</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="foto_perfil">Foto de Perfil (Opcional)</label>
            <div class="input-with-icon">
              <span class="input-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                  <circle cx="12" cy="13" r="3"/>
                </svg>
              </span>
              <input 
                type="file" 
                id="foto_perfil" 
                class="form-control" 
                accept="image/*"
              >
            </div>
            <div class="input-helper">Formato: JPG, PNG. Tamaño máximo: 2MB</div>
          </div>

          <div class="button-group">
            <button type="submit" class="btn btn-primary">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17 21 17 13 7 13 7 21"/>
                <polyline points="7 3 7 8 15 8"/>
              </svg>
              Registrar y Generar QR
            </button>
            <button type="button" class="btn btn-secondary" onclick="limpiarFormulario()">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="1 4 1 10 7 10"/>
                <polyline points="23 20 23 14 17 14"/>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
              </svg>
              Limpiar
            </button>
          </div>
        </form>

        <!-- Contenedor del QR generado -->
        <div id="qr-result" class="qr-result-container">
          <div class="qr-code-wrapper">
            <div id="qrcode"></div>
          </div>
          
          <div class="qr-info">
            <div class="qr-info-row">
              <span class="qr-info-label">Matrícula:</span>
              <span class="qr-info-value" id="qr-matricula"></span>
            </div>
            <div class="qr-info-row">
              <span class="qr-info-label">Nombre:</span>
              <span class="qr-info-value" id="qr-nombre"></span>
            </div>
            <div class="qr-info-row">
              <span class="qr-info-label">Tipo:</span>
              <span class="qr-info-value" id="qr-tipo"></span>
            </div>
            <div class="qr-info-row">
              <span class="qr-info-label">Fecha de Generación:</span>
              <span class="qr-info-value" id="qr-fecha"></span>
            </div>
          </div>

          <button onclick="descargarQR()" class="btn btn-primary download-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Descargar Código QR
          </button>
        </div>
      </div>
    </div>

    <!-- Tab de Editar Persona -->
    <div id="editar-tab" class="tab-content">
      <div class="qr-generator-container">
        <div class="section-header">
          <h2>Editar Persona</h2>
          <p>Busca y modifica los datos de una persona registrada en el sistema</p>
        </div>

        <!-- Buscador de persona -->
        <div class="form-group">
          <label for="buscar-matricula">Buscar por Matrícula</label>
          <div class="input-with-icon">
            <span class="input-icon">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
            </span>
            <input 
              type="text" 
              id="buscar-matricula" 
              class="form-control" 
              placeholder="Ej: 202300097"
              pattern="[0-9]{9}"
              maxlength="9"
            >
          </div>
          <button type="button" class="btn btn-primary" onclick="buscarPersona()" style="margin-top: 1rem; width: 100%;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35"/>
            </svg>
            Buscar
          </button>
        </div>

        <!-- Formulario de edición (oculto inicialmente) -->
        <div id="editar-form-container" style="display: none; margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #dee2e6;">
          <h3 style="margin-bottom: 1.5rem; color: var(--dark-gray);">Datos de la Persona</h3>
          <form id="editar-form">
            <input type="hidden" id="editar-matricula-original" />

            <div class="form-group">
              <label for="editar-matricula">Matrícula *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                    <path d="M6 12v5c0 2 4 3 6 3s6-1 6-3v-5"/>
                  </svg>
                </span>
                <input 
                  type="text" 
                  id="editar-matricula" 
                  class="form-control" 
                  placeholder="Ej: 202300097"
                  pattern="[0-9]{9}"
                  maxlength="9"
                  required
                >
              </div>
            </div>

            <div class="form-group">
              <label for="editar-nombres">Nombres *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                </span>
                <input 
                  type="text" 
                  id="editar-nombres" 
                  class="form-control" 
                  placeholder="Ej: Juan Carlos"
                  required
                >
              </div>
            </div>

            <div class="form-group">
              <label for="editar-apellidos">Apellidos *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                </span>
                <input 
                  type="text" 
                  id="editar-apellidos" 
                  class="form-control" 
                  placeholder="Ej: Pérez García"
                  required
                >
              </div>
            </div>

            <div class="form-group">
              <label for="editar-curp">CURP *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                    <rect x="8" y="2" width="8" height="4" rx="1"/>
                  </svg>
                </span>
                <input 
                  type="text" 
                  id="editar-curp" 
                  class="form-control" 
                  placeholder="Ej: ABCD123456HDFRNN09"
                  pattern="[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9]{2}"
                  maxlength="18"
                  required
                >
              </div>
            </div>

            <div class="form-group">
              <label for="editar-tipo-persona">Tipo de Persona *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                    <circle cx="7" cy="7" r="1.5" fill="currentColor"/>
                  </svg>
                </span>
                <select id="editar-tipo-persona" class="form-control" required>
                  <option value="">Seleccione...</option>
                  <option value="estudiante">Estudiante</option>
                  <option value="docente">Docente</option>
                  <option value="administrativo">Administrativo</option>
                </select>
              </div>
            </div>

            <div class="form-group" id="editar-carrera-group" style="display: none;">
              <label for="editar-id-carrera">Carrera *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                  </svg>
                </span>
                <select id="editar-id-carrera" class="form-control">
                  <option value="">Seleccione...</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="editar-estado">Estado *</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                  </svg>
                </span>
                <select id="editar-estado" class="form-control" required>
                  <option value="activo">Activo</option>
                  <option value="inactivo">Inactivo</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="editar-foto-perfil">Cambiar Foto de Perfil (Opcional)</label>
              <div class="input-with-icon">
                <span class="input-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                    <circle cx="12" cy="13" r="3"/>
                  </svg>
                </span>
                <input 
                  type="file" 
                  id="editar-foto-perfil" 
                  class="form-control" 
                  accept="image/*"
                >
              </div>
              <div class="input-helper">Si no selecciona una imagen, se mantendrá la foto actual</div>
            </div>

            <!-- Vista previa de foto actual -->
            <div id="foto-actual-container" style="display: none; margin-bottom: 1.5rem;">
              <label>Foto Actual</label>
              <div style="text-align: center; margin-top: 0.5rem;">
                <img id="foto-actual-preview" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--orange);" />
              </div>
            </div>

            <div class="button-group">
              <button type="submit" class="btn btn-primary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                  <polyline points="17 21 17 13 7 13 7 21"/>
                  <polyline points="7 3 7 8 15 8"/>
                </svg>
                Guardar Cambios
              </button>
              <button type="button" class="btn btn-secondary" onclick="cancelarEdicion()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Tab de Registros -->
    <div id="registros-tab" class="tab-content">
      <div id="registrosContainer" class="registros-container">
        <div class="tabla-header">
          <h2 class="tabla-titulo">Registros del día</h2>
          <button id="refreshButton" class="refresh-button" onclick="cargarRegistros()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px; vertical-align: middle;">
              <polyline points="23 4 23 10 17 10"/>
              <polyline points="1 20 1 14 7 14"/>
              <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
            </svg>
            Actualizar
          </button>
        </div>
        <table class="registros-table">
          <thead>
            <tr>
              <th>Matrícula</th>
              <th>Nombre Completo</th>
              <th>Carrera</th>
              <th>Entrada</th>
              <th>Salida</th>
              <th>Actividad</th>
            </tr>
          </thead>
          <tbody id="registrosTableBody">
            <!-- Los registros se cargarán aquí dinámicamente -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h3>Universidad Politécnica de Quintana Roo</h3>
        <p>Sistema de Control de Acceso</p>
      </div>
      <div class="footer-section">
        <p><strong>Versión:</strong> 1.1</p>
        <p><strong>Año:</strong> 2025</p>
      </div>
      <div class="footer-section">
        <p>&copy; 2025 UPQROO. Todos los derechos reservados.</p>
        <p>Desarrollado con tecnología web moderna</p>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
</body>
</html>